<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>E‑commerce Hybrid Recommender</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>E‑commerce Hybrid Recommender</h1>
    <p>Try content-based, collaborative, or hybrid recommendations.</p>

    <div class="controls">
      <label for="mode">Mode:</label>
      <select id="mode">
        <option value="hybrid">Hybrid</option>
        <option value="content">Content</option>
        <option value="collab">Collaborative</option>
      </select>
      <label for="content_w">Content weight:</label>
      <input id="content_w" type="number" min="0" max="1" step="0.1" value="0.5">
      <label for="n">Results:</label>
      <input id="n" type="number" min="1" max="12" value="5">
    </div>

    <div class="products">
      {% for p in products %}
      <div class="product-card" data-product-id="{{ p.product_id }}" >
        <h3>{{ p.title }} <span class="price">₹{{ p.price }}</span></h3>
        <p class="category">{{ p.category }}</p>
        <p class="desc">{{ p.description }}</p>
        <button class="rec-btn" onclick="getRec('{{ p.product_id }}')">Recommend similar</button>
      </div>
      {% endfor %}
    </div>

    <h2>Recommendations</h2>
    <div id="recs"></div>
  </div>

<script>
function getRec(productId) {
  const mode = document.getElementById("mode").value;
  const content_w = document.getElementById("content_w").value;
  const n = document.getElementById("n").value;
  fetch(`/api/recommend?product_id=${productId}&mode=${mode}&content_w=${content_w}&n=${n}`)
    .then(r => r.json())
    .then(data => {
      const container = document.getElementById("recs");
      if (!data || data.length === 0) {
        container.innerHTML = "<p>No recommendations found.</p>";
        return;
      }
      let html = "<div class='rec-grid'>";
      data.forEach(p => {
        html += `<div class="rec-card"><h4>${p.title} <span class='price'>₹${p.price}</span></h4><p class='category'>${p.category}</p><p>${p.description}</p></div>`;
      });
      html += "</div>";
      container.innerHTML = html;
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    })
    .catch(err => {
      document.getElementById("recs").innerHTML = "<p>Error fetching recommendations.</p>";
      console.error(err);
    });
}
</script>
</body>
</html>
